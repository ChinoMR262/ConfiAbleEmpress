<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Validación de Empresa123 S.A. - ConfiAbleEmpress</title>
  <!-- Content Security Policy (CSP) para mejorar la seguridad -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; img-src 'self' data: https://placehold.co;">
  
  <!-- Enlace a la hoja de estilos global -->
  <link rel="stylesheet" href="../assets/estiloglobales.css">
  <!-- Enlace a la hoja de estilos específica del certificado final -->
  <link rel="stylesheet" href="../assets/certificadofinal.css">
  <!-- Icono de la página (favicon) -->
  <link rel="icon" href="../assets/logo.png" type="image/png">
  <!-- Enlace a Font Awesome para iconos (ej. pulgares arriba) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../index.html" class="logo">
                <img src="../assets/logo.png" alt="Logo de ConfiAbleEmpress" class="logo-img">
                <h1>ConfiAbleEmpress</h1>
            </a>
            <nav>
                <!-- Aquí se podría añadir un menú de navegación si fuera necesario -->
            </nav>
        </div>
    </header>

    <main>
        <section class="certificate-validation-section content-section">
            <div class="container">
                <img src="../assets/logo.png" alt="Logo de la Empresa" class="company-logo-large">
                <h1 class="company-name-validation">Empresa123 S.A.</h1>
                <p class="validation-slogan">Certificado de Confiabilidad y Transparencia</p>

                <!-- Contenedor del código QR -->
                <div id="qrcode" class="qr-code-container">
                    <!-- El QR se generará aquí con JavaScript -->
                    <p>Escanea para verificar la autenticidad del certificado.</p>
                </div>

                <div class="verification-details">
                    <h3>Detalles de Verificación</h3>
                    <div class="detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Fecha de Emisión:</span> <span>01 de Enero de 2025</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-calendar-times"></i>
                        <span>Fecha de Vencimiento:</span> <span id="expirationDate">30 de Septiembre de 2025</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-star"></i>
                        <span>Nivel de Confiabilidad:</span>
                        <span class="star-rating">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i> (3 Estrellas)
                        </span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-signature"></i>
                        <span>Firma de ConfiAbleEmpress:</span> <span>Sistema Automático de Validación</span>
                    </div>
                    <p id="expiredMessage" class="expired-message" style="display: none;">¡Este certificado ha expirado!</p>
                </div>

                <!-- Barra de confianza interactiva (solo visual y simulada) -->
                <div class="trust-bar-container">
                    <div class="trust-segment" data-segment="security" style="width: 25%;">
                        <span class="trust-tooltip">Seguridad (25%)</span>
                    </div>
                    <div class="trust-segment" data-segment="transparency" style="width: 20%;">
                        <span class="trust-tooltip">Transparencia (20%)</span>
                    </div>
                    <div class="trust-segment" data-segment="reputation" style="width: 30%;">
                        <span class="trust-tooltip">Reputación (30%)</span>
                    </div>
                    <div class="trust-segment" data-segment="experience" style="width: 15%;">
                        <span class="trust-tooltip">Experiencia (15%)</span>
                    </div>
                    <div class="trust-segment" data-segment="innovation" style="width: 10%;">
                        <span class="trust-tooltip">Innovación (10%)</span>
                    </div>
                </div>

                <!-- Sección de comentarios simulados -->
                <div class="comment-section">
                    <h2>Comentarios de Clientes (Simulados)</h2>
                    <div id="simulated-comments" class="comment-list">
                        <!-- Comentarios se renderizarán aquí -->
                    </div>

                    <!-- Formulario de comentario simulado -->
                    <div class="comment-form">
                        <h3>Deja un Comentario</h3>
                        <div class="form-group">
                            <label for="fakeCommentName">Tu Nombre:</label>
                            <input type="text" id="fakeCommentName" placeholder="Tu nombre">
                        </div>
                        <div class="form-group">
                            <label for="fakeCommentText">Tu Comentario:</label>
                            <textarea id="fakeCommentText" rows="4" placeholder="Escribe tu comentario aquí..."></textarea>
                        </div>
                        <button id="submitFakeComment">Enviar Comentario (Simulado)</button>
                        <p id="fakeMessage" class="fake-message"></p>
                    </div>

                    <!-- Botón para cargar más comentarios (opcional) -->
                    <button id="loadMoreComments" class="cta-button">Cargar Más Comentarios</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="../TÉRMINOS DE USO Y POLÍTICA.html">Términos de Uso y Política de Validación</a>
                <a href="../politica-privacidad.html">Política de Privacidad</a>
                <a href="../politica-de-cookies.html">Política de Cookies</a>
                <a href="../seguridad-total.html">Seguridad Total</a>
            </div>
            <div class="footer-contact">
                <p>Contacto: <a href="mailto:chinooficial262@gmail.com">chinooficial262@gmail.com</a></p>
                <div class="legal-notice-container">
                    <p class="legal-notice">
                        Aviso Legal: ConfiAbleEmpress ofrece un servicio de validación visual con fines de marketing. No nos hacemos responsables por los servicios prestados por las empresas listadas. Se recomienda a los usuarios ejercer su propio juicio.
                    </p>
                </div>
            </div>
            <div class="footer-copyright">
                &copy; 2025 ConfiAbleEmpress. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <!-- Librería qrcode.js (asegúrate de que la ruta sea correcta si es local o usa CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <!-- Script principal para la lógica de la página de validación -->
    <script src="../js/generate.js"></script>

    <script>
        // === Lógica de la barra de confianza interactiva (TOOLTIPS) ===
        function setupTrustBarInteractivity() {
            const trustSegments = document.querySelectorAll('.trust-segment');
            trustSegments.forEach(segment => {
                const trustTooltip = segment.querySelector('.trust-tooltip');

                segment.addEventListener('mouseover', () => {
                    trustTooltip.classList.add('show');
                });

                segment.addEventListener('mouseout', () => {
                    trustTooltip.classList.remove('show');
                });
            });
        }

        // === Simulación de Comentarios ===
        let allComments = []; // Almacena todos los comentarios para la simulación

        // Función para cargar comentarios desde un JSON (simulado)
        async function loadComments() {
            // En una aplicación real, aquí harías un fetch a una API.
            // Para la simulación, usamos un array predefinido.
            return [
                { id: 1, author: 'Ana G.', date: '2024-05-15', text: '¡Excelente servicio! Muy profesionales y eficientes. Altamente recomendados.', likes: 15, dislikes: 0 },
                { id: 2, author: 'Carlos R.', date: '2024-05-18', text: 'Gran experiencia con esta empresa. Cumplieron con todo lo prometido y más. La atención al cliente es fantástica.', likes: 12, dislikes: 1 },
                { id: 3, author: 'Marta L.', date: '2024-05-20', text: 'Producto de calidad y entrega rápida. Volveré a comprar sin duda.', likes: 10, dislikes: 0 },
                { id: 4, author: 'Juan P.', date: '2024-05-22', text: 'Me encantó la atención personalizada. Resolvieron todas mis dudas. Muy confiables.', likes: 8, dislikes: 0 },
                { id: 5, author: 'Sofía M.', date: '2024-05-25', text: 'Buen servicio, aunque la comunicación podría mejorar un poco. En general, satisfecha.', likes: 7, dislikes: 2 },
                { id: 6, author: 'David S.', date: '2024-05-28', text: 'Rápidos y efectivos. El certificado de confiabilidad es un plus que me dio mucha tranquilidad.', likes: 18, dislikes: 0 },
                { id: 7, author: 'Laura F.', date: '2024-06-01', text: 'Tuve un pequeño inconveniente, pero lo resolvieron rápidamente. Buena respuesta.', likes: 5, dislikes: 1 },
                { id: 8, author: 'Pedro V.', date: '2024-06-03', text: 'Totalmente recomendado. La validez visual de ConfiAbleEmpress realmente marca la diferencia.', likes: 20, dislikes: 0 },
                { id: 9, author: 'Elena H.', date: '2024-06-05', text: 'Excelente relación calidad-precio. Superaron mis expectativas.', likes: 11, dislikes: 0 },
                { id: 10, author: 'Ricardo C.', date: '2024-06-08', text: 'El proceso fue muy sencillo y transparente. Sigan así.', likes: 9, dislikes: 0 },
                { id: 11, author: 'Gisela B.', date: '2024-06-10', text: 'Servicio al cliente excepcional, siempre dispuestos a ayudar.', likes: 14, dislikes: 0 },
                { id: 12, author: 'Fernando P.', date: '2024-06-12', text: 'Producto innovador y muy útil. Imprescindible para cualquier negocio.', likes: 16, dislikes: 0 },
                { id: 13, author: 'Valeria S.', date: '2024-06-15', text: 'Profesionalismo y seriedad, dos palabras que describen a esta empresa.', likes: 13, dislikes: 0 },
                { id: 14, author: 'José L.', date: '2024-06-18', text: 'Contento con los resultados. La inversión valió la pena.', likes: 10, dislikes: 1 },
                { id: 15, author: 'Carolina G.', date: '2024-06-20', text: 'Una plataforma muy intuitiva, fácil de usar y con grandes beneficios.', likes: 17, dislikes: 0 }
            ];
        }

        // Función para renderizar comentarios en el DOM
        function renderComments(numComments, containerElement) {
            if (!containerElement) return;

            // Limpiar comentarios existentes si no se está añadiendo a una lista infinita
            if (numComments <= 3) { // Asumimos que 3 es la carga inicial
                containerElement.innerHTML = '';
            }

            const currentCommentsCount = containerElement.children.length;
            const commentsToRender = allComments.slice(currentCommentsCount, currentCommentsCount + numComments);

            commentsToRender.forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.classList.add('comment-item');
                commentDiv.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-author">${comment.author}</span>
                        <span class="comment-date">${comment.date}</span>
                    </div>
                    <p class="comment-body">${comment.text}</p>
                    <div class="comment-actions">
                        <button class="vote-button like" data-id="${comment.id}"><i class="fas fa-thumbs-up"></i> <span class="like-count">${comment.likes}</span></button>
                        <button class="vote-button dislike" data-id="${comment.id}"><i class="fas fa-thumbs-down"></i> <span class="dislike-count">${comment.dislikes}</span></button>
                    </div>
                `;
                containerElement.appendChild(commentDiv);
            });

            // Actualizar visibilidad del botón "Cargar Más Comentarios"
            const loadMoreButton = document.getElementById('loadMoreComments');
            if (loadMoreButton) {
                if (containerElement.children.length >= allComments.length) {
                    loadMoreButton.style.display = 'none'; // Ocultar si no hay más comentarios
                } else {
                    loadMoreButton.style.display = 'block'; // Mostrar si hay más
                }
            }
            addVoteListeners(); // Re-añadir listeners a los nuevos botones de voto
        }

        // Añadir listeners a los botones de voto
        function addVoteListeners() {
            document.querySelectorAll('.vote-button.like').forEach(button => {
                button.onclick = (e) => handleVote(e, 'like');
            });
            document.querySelectorAll('.vote-button.dislike').forEach(button => {
                button.onclick = (e) => handleVote(e, 'dislike');
            });
        }

        // Manejar el voto (simulado)
        function handleVote(event, type) {
            const button = event.currentTarget;
            const commentId = parseInt(button.dataset.id);
            const comment = allComments.find(c => c.id === commentId);

            if (comment) {
                if (type === 'like') {
                    comment.likes++;
                } else {
                    comment.dislikes++;
                }
                // Simplemente actualizamos el contador en el DOM sin recargar la lista
                const likeCountSpan = button.parentElement.querySelector('.like-count');
                const dislikeCountSpan = button.parentElement.querySelector('.dislike-count');
                if (likeCountSpan) likeCountSpan.textContent = comment.likes;
                if (dislikeCountSpan) dislikeCountSpan.textContent = comment.dislikes;
            }
        }

        // Simula la adición de un comentario aleatorio para demostración
        function addRandomCommentAutomatically() {
            const newComment = {
                id: allComments.length + 1,
                author: `Visitante ${allComments.length + 1}`,
                date: new Date().toISOString().slice(0, 10),
                text: `¡Un comentario más! Increíble servicio, lo recomiendo.`,
                likes: Math.floor(Math.random() * 10),
                dislikes: Math.floor(Math.random() * 3)
            };
            allComments.push(newComment);
            renderComments(1, document.getElementById('simulated-comments')); // Renderiza el último comentario añadido
        }


        // Función para simular el envío de comentarios y modales
        function simulateComments() {
            const submitFakeCommentButton = document.getElementById('submitFakeComment');
            const fakeCommentNameInput = document.getElementById('fakeCommentName');
            const fakeCommentTextInput = document.getElementById('fakeCommentText');
            const fakeMessage = document.getElementById('fakeMessage');

            if (submitFakeCommentButton) {
                submitFakeCommentButton.addEventListener('click', () => {
                    const name = fakeCommentNameInput.value.trim();
                    const text = fakeCommentTextInput.value.trim();

                    if (name && text) {
                        fakeMessage.textContent = `¡Gracias por tu comentario, ${name}! (Este es un mensaje simulado, el comentario no se guarda)`;
                        fakeMessage.style.display = 'block'; // Muestra el mensaje.
                        fakeMessage.style.backgroundColor = '#d4edda'; // Color de éxito
                        fakeMessage.style.color = '#155724';
                        fakeCommentNameInput.value = ''; // Limpia el campo de nombre.
                        fakeCommentTextInput.value = ''; // Limpia el campo de texto del comentario.
                        setTimeout(() => {
                            fakeMessage.style.display = 'none'; // Oculta el mensaje después de 5 segundos.
                        }, 5000);
                    } else {
                        fakeMessage.textContent = 'Por favor, ingresa tu nombre y un comentario.';
                        fakeMessage.style.display = 'block';
                        fakeMessage.style.backgroundColor = '#f8d7da'; // Color de error
                        fakeMessage.style.color = '#721c24';
                        setTimeout(() => {
                            fakeMessage.style.display = 'none';
                        }, 3000);
                    }
                });
            }

            const loadMoreButton = document.getElementById('loadMoreComments');
            if (loadMoreButton) {
                loadMoreButton.addEventListener('click', () => {
                    renderComments(3, document.getElementById('simulated-comments')); // Carga 3 comentarios más
                });
            }
        }

        // Función para verificar la expiración del certificado
        function checkCertificateExpiration() {
            const expirationDateElement = document.getElementById('expirationDate');
            const expiredMessageElement = document.getElementById('expiredMessage');

            if (expirationDateElement && expiredMessageElement) {
                const expirationDateStr = expirationDateElement.textContent;
                const expirationDate = new Date(expirationDateStr);
                const today = new Date();

                // Normalizar las fechas para comparar solo año, mes y día
                expirationDate.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);

                if (today > expirationDate) {
                    expiredMessageElement.style.display = 'block';
                    // Opcional: Deshabilitar formulario de comentarios o barra de confianza
                } else {
                    expiredMessageElement.style.display = 'none';
                }
            }
        }

        // Generar el QR para esta página específica
        function generateQRCode() {
            const qrDiv = document.getElementById('qrcode');
            if (qrDiv) {
                // Genera una URL de ejemplo. En un entorno real, sería la URL de esta página de validación.
                const verificationUrl = "https://confiableempress.com/certificados/empresa123.html";
                const qr = qrcode(0, 'L'); // Nivel de corrección de error L
                qr.addData(verificationUrl);
                qr.make();
                qrDiv.innerHTML = `<img src="${qr.createDataURL(6)}" alt="Código QR de Verificación">
                                   <p>Escanea para verificar la autenticidad del certificado.</p>`;
            }
        }


        // === Inicialización al cargar el DOM ===
        document.addEventListener('DOMContentLoaded', async () => {
            // Cargar todos los comentarios simulados una vez al inicio
            allComments = await loadComments();

            // Renderizar los comentarios iniciales (por ejemplo, los primeros 3)
            renderComments(3, document.getElementById('simulated-comments'));

            // Configurar la interactividad del formulario de comentarios y modales
            simulateComments();

            // Configurar la interactividad de la barra de confianza
            setupTrustBarInteractivity();

            // Verificar la expiración del certificado
            checkCertificateExpiration();

            // Generar el código QR
            generateQRCode();

            // Configurar la adición automática de comentarios cada 5 minutos (300000 ms)
            setInterval(addRandomCommentAutomatically, 300000); // 5 minutos
        });
    </script>
</body>
</html>
